# 广告申请管理功能

## 功能概述

本系统实现了完整的广告申请管理功能，包括申请列表查看、新增申请、审核等功能。

## 功能特点

### 1. 申请列表功能
- **多条件搜索**：支持按编号、广告位置、面积、类型、广告性质、审核状态、区域等条件搜索
- **列表展示**：显示编号、区域、广告位置、户外广告设置类型、广告性质、面积、审核状态等字段
- **分页显示**：支持分页浏览，可调整每页显示数量
- **操作功能**：查看详情、审核申请等操作

### 2. 新增申请功能（全新树状图界面）
- **左侧树状图选择**：采用左右分栏布局，左侧显示省市区街道的树状结构
- **区域信息展示**：点击树状图节点后右侧显示选中区域的详细信息
  - 区域名称、区域类型
  - 经纬度坐标
  - 区域图片
- **存量广告位列表**：选择具体街道后显示该区域的存量广告位表格
  - 编号、广告位置、面积、广告性质
  - 支持点击"选择"按钮选中广告位
- **广告位详情展示**：选中广告位后显示详细信息
  - 编号、面积、广告性质
  - 地图点位经纬度
  - 广告位实图
- **申请信息录入**：
  - 户外广告设置类型（下拉选择）
  - 总面积（数字输入）
  - 规格（文本输入）
  - 数量（数字输入）
- **文件上传**：支持上传7种必需文件
  - 重庆市大型户外广告设置申请表
  - 户外广告设施施工、运行安全承诺书
  - 大型户外广告场地协议
  - 大型户外广告设置实景效果图
  - 广告设施结构设计图
  - 户外广告设置依托的建筑物原貌图
  - 设置场地建筑物设施等的产权证书

### 3. 审核功能
- **审核状态管理**：待审核、已通过、已拒绝
- **审核备注**：支持填写审核意见
- **审核记录**：记录审核人和审核时间

## 界面设计

### 新增申请界面布局
```
┌─────────────────────────────────────────────────────────┐
│                    新增广告申请                           │
├─────────────────┬───────────────────────────────────────┤
│   左侧区域树     │           右侧表单区域                  │
│                 │                                       │
│ ┌─选择区域─┐    │ ┌─选中区域信息─┐                       │
│ │ ├─北京市  │    │ │区域名称：东城区│                       │
│ │ │├─东城区 │    │ │区域类型：区    │                       │
│ │ │├─西城区 │    │ │经度：116.xxx  │                       │
│ │ │└─朝阳区 │    │ │纬度：39.xxx   │                       │
│ │ └─────── │    │ └──────────── │                       │
│ │           │    │                                       │
│ │           │    │ ┌─存量广告位列表─┐                     │
│ │           │    │ │编号│位置│面积│操作│                   │
│ │           │    │ │AD01│...│...│选择│                   │
│ │           │    │ └──────────────│                     │
│ │           │    │                                       │
│ │           │    │ ┌─选中广告位详情─┐                     │
│ │           │    │ │编号、经纬度、实图│                     │
│ │           │    │ └──────────────│                     │
│ │           │    │                                       │
│ │           │    │ ┌─申请信息─┐                          │
│ │           │    │ │设置类型等 │                          │
│ │           │    │ └────────│                          │
│ │           │    │                                       │
│ │           │    │ ┌─申请材料上传─┐                       │
│ │           │    │ │7个文件上传  │                        │
│ └───────────┘    │ └──────────│                        │
└─────────────────┴───────────────────────────────────────┘
```

## 数据库表结构

### 1. 广告位基础信息表 (advertisement_position)
- 存储广告位的基本信息
- 包含编号、位置、面积、性质、区域关联等字段

### 2. 广告申请表 (advertisement_application)
- 存储申请的详细信息
- 包含申请信息、文件URL、审核状态等字段

### 3. 组织表扩展 (organization)
新增字段：
- `longitude`: 经度
- `latitude`: 纬度  
- `region_image`: 区域图片URL
- `region_type`: 区域类型（省、市、区、街道）

## 技术实现

### 后端技术栈
- **Spring Boot**: 主框架
- **MyBatis-Plus**: ORM框架，使用LambdaQuery
- **MySQL**: 数据库
- **Lombok**: 减少样板代码

### 前端技术栈
- **Vue 3**: 前端框架
- **Element Plus**: UI组件库
- **Composition API**: Vue 3组合式API
- **el-tree**: 树形组件实现层级选择
- **el-table**: 表格组件展示广告位列表

### 架构设计
- **MVC架构**: Controller、Service、Mapper分层
- **DTO/VO模式**: 数据传输和视图对象分离
- **无外键设计**: 符合开发规范

## API接口

### 广告申请相关接口
- `GET /api/admin/advertisement/applications` - 分页查询申请列表
- `POST /api/admin/advertisement/applications` - 新增申请
- `GET /api/admin/advertisement/applications/{id}` - 获取申请详情
- `PUT /api/admin/advertisement/applications/{id}/audit` - 审核申请

### 广告位相关接口
- `GET /api/admin/advertisement/positions` - 根据区域获取广告位
- `GET /api/admin/advertisement/positions/{id}` - 获取广告位详情

### 组织管理接口
- `GET /api/admin/organization/tree` - 获取组织树（包含经纬度和图片信息）

### 文件上传接口
- `POST /api/admin/upload` - 文件上传

## 使用说明

### 1. 数据库初始化
执行 `database/modification_statements.sql` 文件创建表和初始化数据

### 2. 访问功能
- 登录系统后，在左侧菜单找到"广告管理" -> "申请列表"
- 管理员用户具有完整的查看、新增、审核权限

### 3. 新增申请流程（新）
1. 点击"新增申请"按钮，打开1200px宽的对话框
2. 在左侧树状图中浏览省市区街道结构
3. 点击具体街道节点，右侧显示：
   - 选中区域的基本信息（名称、类型、经纬度、图片）
   - 该区域的存量广告位列表
4. 在广告位列表中点击"选择"按钮选中具体广告位
5. 查看选中广告位的详细信息（编号、经纬度、实图等）
6. 填写申请信息（设置类型、总面积、规格、数量）
7. 依次上传7个必需文件
8. 点击"提交申请"完成申请

### 4. 审核流程
1. 在申请列表中找到待审核申请
2. 点击"审核"按钮
3. 选择审核结果（通过/拒绝）
4. 填写审核备注
5. 确认审核

## 文件结构

```
src/main/java/com/example/
├── entity/
│   ├── AdvertisementPosition.java      # 广告位实体
│   ├── AdvertisementApplication.java   # 广告申请实体
│   └── Organization.java               # 组织实体（已扩展）
├── dto/
│   └── AdvertisementApplicationDTO.java # 申请DTO
├── vo/
│   ├── AdvertisementApplicationVO.java  # 申请VO
│   ├── AdvertisementPositionVO.java     # 广告位VO
│   └── OrganizationTreeVO.java          # 组织树VO（已扩展）
├── mapper/
│   ├── AdvertisementPositionMapper.java    # 广告位Mapper
│   └── AdvertisementApplicationMapper.java # 申请Mapper
├── service/
│   ├── AdvertisementPositionService.java      # 广告位Service
│   ├── AdvertisementApplicationService.java   # 申请Service
│   └── impl/
│       ├── AdvertisementPositionServiceImpl.java
│       └── AdvertisementApplicationServiceImpl.java
└── controller/
    └── AdvertisementController.java    # 控制器

frontend/src/
├── views/
│   └── AdvertisementManagement.vue     # 申请管理页面
├── components/
│   ├── AdvertisementAddForm.vue        # 新增申请表单（全新设计）
│   └── AdvertisementDetail.vue         # 申请详情组件
└── api/
    └── advertisement.js                # API接口
```

## 新功能亮点

1. **直观的树状图界面**：采用Element Plus的el-tree组件，支持省市区街道四级结构展示
2. **智能的信息联动**：选择区域自动显示该区域信息和存量广告位
3. **丰富的信息展示**：包含经纬度、区域图片等地理信息
4. **优化的用户体验**：左右分栏布局，信息层次清晰
5. **实时的数据更新**：所有信息都从后端API实时获取

## 注意事项

1. **数据库字段更新**：确保执行了ALTER TABLE语句添加新字段
2. **文件上传**: 确保所有7个文件都已上传才能提交申请
3. **权限控制**: 只有管理员可以进行审核操作
4. **状态管理**: 申请状态分为待审核、已通过、已拒绝三种
5. **编号生成**: 申请编号自动生成，格式为APP+日期+序号
6. **文件大小**: 上传文件限制10MB以内
7. **区域选择**: 必须选择到具体的街道级别才能看到存量广告位

## 扩展功能

后续可以扩展的功能：
1. 地图组件集成，在地图上显示广告位位置
2. 区域图片的在线编辑和上传功能
3. 批量导入广告位数据功能
4. 移动端适配
5. 数据统计和可视化报表 